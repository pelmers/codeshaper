(self.webpackChunk=self.webpackChunk||[]).push([[487],{6487:(t,e,n)=>{"use strict";n.r(e),n.d(e,{drawCode:()=>C});var a=n(1742),o=n(3883),r=n(1217);class s extends r.pi{constructor(t){super(t,{compact:!0,comments:!1})}generate(){const t=this._generator,e=t.word.bind(t);t.word=n=>{e(n),["return","break","continue","async","throw","yield","await"].includes(n)&&t._unbreakableSpace()};const n=t.UnaryExpression.bind(t);t.UnaryExpression=e=>{!("operator"in e)||"+"!==e.operator&&"-"!==e.operator||t._space(),n(e)};const o=t.UpdateExpression.bind(t);t.UpdateExpression=e=>{let n=!1;"prefix"in e&&e.prefix?t._space():n=!0,o(e),n&&t._space()},t.space=(e=!1)=>{t._buf.hasContent()&&!t.endsWith(" ")&&!t.endsWith("\n")||e?t._space():t._optionalSpace()},t._space=()=>{t._append(a.wN,!0)},t._optionalSpace=()=>{t._append(a.lR,!0)},t._unbreakableSpace=()=>{t._append(a.JK,!0)};const r=t.token.bind(t);return t.token=e=>{"=>"===e&&t._unbreakableSpace(),r(e),t._optionalSpace()},super.generate()}}const h=Number.MAX_SAFE_INTEGER;function c(t){return t.map(p).reduce(((t,e)=>t+e.length),0)}function i(t){return"text"in t?t.text.length:"opt"===t.space?0:1}function p(t){return"text"in t?t.text:"opt"===t.space?"":" "}function l(t){return"space"in t&&"ubn"===t.space}var u=n(2824);class d{static hex2lab(t){const[e,n,a,o]=d.hex2rgba(t),[r,s,h]=d.rgb2xyz(e,n,a,o);return d.xyz2lab(r,s,h)}static rgba2lab(t,e,n,a=1){const[o,r,s]=d.rgb2xyz(t,e,n,a);return d.xyz2lab(o,r,s)}static lab2rgba(t,e,n){const[a,o,r]=d.lab2xyz(t,e,n);return d.xyz2rgba(a,o,r)}static hex2rgba(t){let e;if("#"===t.charAt(0)&&(e=t.substring(1).split("")),e.length>6||e.length<3)throw new Error(`HEX colour must be 3 or 6 values. You provided it ${e.length}`);return 3===e.length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),e="0x"+e.join(""),[e>>16&255,e>>8&255,255&e,1]}static rgb2xyz(t,e,n,a=1){return t>255?t=255:t<0&&(t=0),e>255?e=255:e<0&&(e=0),n>255?n=255:n<0&&(n=0),a>1?a=1:a<0&&(a=0),e/=255,n/=255,(t/=255)>.04045?t=Math.pow((t+.055)/1.055,2.4):t/=12.92,e>.04045?e=Math.pow((e+.055)/1.055,2.4):e/=12.92,n>.04045?n=Math.pow((n+.055)/1.055,2.4):n/=12.92,[.4124564*(t*=100)+.3575761*(e*=100)+.1804375*(n*=100),.2126729*t+.7151522*e+.072175*n,.0193339*t+.119192*e+.9503041*n]}static xyz2rgba(t,e,n){let a=t/100,o=e/100,r=n/100,s=3.2404542*a+-1.5371385*o+-.4985314*r,h=-.969266*a+1.8760108*o+.041556*r,c=.0556434*a+-.2040259*o+1.0572252*r;return s>.0031308?s=1.055*Math.pow(s,1/2.4)-.055:s*=12.92,h>.0031308?h=1.055*Math.pow(h,1/2.4)-.055:h*=12.92,c>.0031308?c=1.055*Math.pow(c,1/2.4)-.055:c*=12.92,[Math.round(255*s),Math.round(255*h),Math.round(255*c),1]}static xyz2lab(t,e,n){return e/=100,n/=107.304,t=(t/=94.811)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(t-e),200*(e-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]}static lab2xyz(t,e,n){let a=(t+16)/116,o=e/500+a,r=a-n/200;return a=Math.pow(a,3)>.008856?Math.pow(a,3):(a-16/116)/7.787,o=Math.pow(o,3)>.008856?Math.pow(o,3):(o-16/116)/7.787,r=Math.pow(r,3)>.008856?Math.pow(r,3):(r-16/116)/7.787,[94.811*o,100*a,107.304*r]}static deltaE00(t,e,n,a,o,r){Math.rad2deg=function(t){return 360*t/(2*Math.PI)},Math.deg2rad=function(t){return 2*Math.PI*t/360};const s=(t+a)/2,h=(Math.sqrt(Math.pow(e,2)+Math.pow(n,2))+Math.sqrt(Math.pow(o,2)+Math.pow(r,2)))/2,c=(1-Math.sqrt(Math.pow(h,7)/(Math.pow(h,7)+Math.pow(25,7))))/2,i=e*(1+c),p=o*(1+c),l=Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),u=Math.sqrt(Math.pow(p,2)+Math.pow(r,2)),d=(l+u)/2;let g=Math.rad2deg(Math.atan2(n,i));g<0&&(g+=360);let M=Math.rad2deg(Math.atan2(r,p));M<0&&(M+=360);const w=Math.abs(g-M)>180?(g+M+360)/2:(g+M)/2,f=1-.17*Math.cos(Math.deg2rad(w-30))+.24*Math.cos(Math.deg2rad(2*w))+.32*Math.cos(Math.deg2rad(3*w+6))-.2*Math.cos(Math.deg2rad(4*w-63));let b=M-g;Math.abs(b)>180&&(M<=g?b+=360:b-=360);const x=a-t,m=u-l;b=2*Math.sqrt(l*u)*Math.sin(Math.deg2rad(b)/2);const y=1+.015*Math.pow(s-50,2)/Math.sqrt(20+Math.pow(s-50,2)),v=1+.045*d,E=1+.015*d*f,_=30*Math.exp(-Math.pow((w-275)/25,2)),q=-2*Math.sqrt(Math.pow(d,7)/(Math.pow(d,7)+Math.pow(25,7)))*Math.sin(2*Math.deg2rad(_));return Math.sqrt(Math.pow(x/(1*y),2)+Math.pow(m/(1*v),2)+Math.pow(b/(1*E),2)+q*(m/(1*v))*(b/(1*E)))}static getDarkerColour(t,e,n,a=1,o=.05){let[r,s,h]=d.rgba2lab(t,e,n,a);return r-=r*o,r<0&&(r=0),d.lab2rgba(r,s,h)}static getBrighterColour(t,e,n,a=1,o=.05){let[r,s,h]=d.rgba2lab(t,e,n,a);return r+=r*o,r>100&&(r=100),d.lab2rgba(r,s,h)}}var g=n(7428),M=n.n(g);const w=256/a.p$,f=t=>Math.floor(t/w),b=(t,e,n)=>f(t)*a.p$*a.p$+f(e)*a.p$+f(n),x=new Array(Math.pow(a.p$,3)).fill(0).map(((t,e)=>{const n=Math.floor(e/(a.p$*a.p$)),o=Math.floor((e-n)/a.p$);return[(n+.5)*w,(o+.5)*w,(e-n-o+.5)*w]})),m=new(M())({max:2*Math.pow(a.p$,3)});function y(t,e,n){const a=[t,e,n].join(" "),o=m.get(a);if(null!=o)return o;{const o=d.rgba2lab(t,e,n);return m.set(a,o),o}}class v{constructor(t){this.compressed=[],this.originalToCompressedMap=new Map;const e=t.reduce(((t,e)=>t+e),0),n=Math.round(.95*e),a=t.map(((t,e)=>({v:t,idx:e}))).sort(((t,e)=>e.v-t.v));let o,r;for(o=0,r=0;o<a.length&&r<n;o++){const{v:t,idx:e}=a[o];r+=t,this.compressed.push({originalIndex:e,count:t}),this.originalToCompressedMap.set(e,this.compressed.length-1)}for(;o<a.length;o++){const{v:t,idx:e}=a[o],[n,r,s]=x[e],[h,c,i]=y(n,r,s);let p=Number.MAX_SAFE_INTEGER,l=0;for(const{delta:t,idx:e}of this.compressed.map((({originalIndex:t},e)=>{const[n,a,o]=x[t],[r,s,p]=y(n,a,o);return{delta:d.deltaE00(h,c,i,r,s,p),idx:e}})))t<p&&(p=t,l=e);this.compressed[l].count+=t,this.originalToCompressedMap.set(e,l)}}saliency(t,e,n){const a=b(t,e,n),o=this.originalToCompressedMap.get(a);return this.compressed.reduce(((a,r,s)=>{if(s===o)return a;{const[o,s,h]=x[r.originalIndex];return a+r.count*((t,e,n,a,o,r)=>{const[s,h,c]=y(t,e,n),[i,p,l]=y(a,o,r);return d.deltaE00(s,h,c,i,p,l)})(t,e,n,o,s,h)}}),0)}}function E(t,e,n,r,d,g){return M=this,w=void 0,x=function*(){const M=function(t){const e=[];for(const n of t.split(a.JK)){const t=n.split(a.wN);for(const n of t){const t=n.split(a.lR);for(const n of t)e.push({text:n}),e.push({space:"opt"});e.push({space:"req"})}e.push({space:"ubn"})}return function(t){const e=(t,e)=>{if("space"in t&&"space"in e)return"ubn"===t.space||"ubn"===e.space?"ubn":"req"===t.space||"req"===e.space?"req":"opt";throw new Error("unreachable statement")},n=[];for(let a=0;a<t.length;a++){const o=n[n.length-1],r=t[a];"text"in r&&""===r.text||(null==o?n.push(r):"space"in o&&"space"in r?o.space=e(o,r):n.push(r))}return n}(e)}(new s((0,o.Qc)(t)).generate().code);d&&(r=1-r);const w=c(M)*a.yU/r,{canvas:f,ctx:x}=yield g(e,w),m="saliency"===n?function(t,e,n,o){const r=e.getImageData(0,0,t.width,t.height),s=new Array(Math.pow(a.p$,3)).fill(0);for(let t=0;t<r.data.length;t+=4){const[e,n,a]=r.data.slice(t,t+3);s[b(e,n,a)]++}const h=new v(s),c=new Array(t.width*t.height);for(let t=0;t<r.data.length;t+=4){const[e,n,a]=r.data.slice(t,t+3);c[t/4]=h.saliency(e,n,a)}const i=c.concat().sort(((t,e)=>o?t-e:e-t)),p=i[Math.round(n*i.length)];return(0,u.L)(r.width,r.height,((t,e)=>{const n=t*r.width+e;return o?c[n]<=p:c[n]>=p}))}(f,x,r,d):function(t,e,n,o){const r=e.getImageData(0,0,t.width,t.height),s=new Array(a.Ro).fill(0);for(let t=0;t<r.data.length;t+=4){const[e,n,a,o]=r.data.slice(t,t+4);s[Math.round(o/255*(e+n+a))]++}const h=r.width*r.height*n;let c=0,i=s.length-1;for(o&&s.reverse();c<h&&i>0;)c+=s[i],i--;return o&&(i=s.length-1-i),(0,u.L)(r.width,r.height,((t,e)=>{const n=t*r.width+e,[a,s,h,c]=r.data.slice(4*n,4*(n+1)),p=Math.round(c/255*(a+s+h));return o?p<=i:p>=i}))}(f,x,r,d),y=function(t,e){const n=t=>{return Math.min(h,(e=t)<m.length?m[e].length:Number.MAX_SAFE_INTEGER);var e},a=[[]];let o=0;for(let e=0;e<t.length;e++){const r=t[e],s=a.length-1,h=n(s);if(0===o||l(r)||"text"in r)a[s].push(r),o+=i(r);else{let n=0;for(let a=e+1;a<t.length&&(!("space"in t[a])||l(t[a]));a++)n+=i(t[a]);o+n<=h?(a[s].push(r),o+=i(r)):(a.push([{space:"opt"}]),o=0)}}for(let t=0;t<a.length;t++){const e=a[t];if(n(t)===h)continue;let o=Math.round(n(t)-c(e));const r=e.slice(0,e.length-1).map(((t,e)=>({t,idx:e}))).filter((({t})=>"space"in t)).map((({idx:t})=>t));for(;r.length>0&&o>0;){const t=r[Math.floor(r.length*Math.random())];e[t]={text:`${p(e[t])} `},o--}}return a.map((t=>t.map(p).join("")))}(M);if(y.length>m.length+1)throw new Error(`Unexpected segment length of ${y.length} from ${m.length} runs`);for(;y.length<m.length;){const t=m[y.length].length;t>5?y.push(`/*${"o".repeat(t-4)}*/`):y.push(" ".repeat(t))}let E="",_=0;for(let t=0;t<f.height;t++){for(let e=0;e<f.width;e++){const n=t*f.width+e;_<m.length&&n>=m[_][0]?(E+=y[_]+" ",e+=y[_].length,_++):E+=" "}E+="\n"}for(let t=_;t<y.length;t++)E+=`\n${y[t]}`;return E},new((f=void 0)||(f=Promise))((function(t,e){function n(t){try{o(x.next(t))}catch(t){e(t)}}function a(t){try{o(x.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof f?o:new f((function(t){t(o)}))).then(n,a)}o((x=x.apply(M,w||[])).next())}));var M,w,f,x}var _=function(t,e,n,a){return new(n||(n=Promise))((function(o,r){function s(t){try{c(a.next(t))}catch(t){r(t)}}function h(t){try{c(a.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,h)}c((a=a.apply(t,e||[])).next())}))};const q=n.e(183).then(n.t.bind(n,5183,23));function $(t,e){return _(this,void 0,void 0,(function*(){const n=document.createElement("canvas"),o=n.getContext("2d");yield new Promise(((e,a)=>{const r=new Image;r.onload=()=>{n.width=Math.floor(r.width),n.height=Math.floor(r.height),o.drawImage(r,0,0,n.width,n.height),e()},r.onerror=a,r.src=t}));const r=document.createElement("canvas"),s=Math.sqrt(e/(n.width*n.height));r.width=Math.round(n.width*s*Math.sqrt(a.xO)),r.height=Math.round(n.height*s/Math.sqrt(a.xO));const h=(yield q).default();return yield h.resize(n,r),{canvas:r,ctx:r.getContext("2d")}}))}function C(t,e,n,a,o){return _(this,void 0,void 0,(function*(){console.time("code shaping");const r=yield E(t,e,n,a,o,$);return console.timeEnd("code shaping"),r}))}}}]);